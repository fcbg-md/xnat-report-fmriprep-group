# Copyright 2023 The NiPreps Developers <nipreps@gmail.com>
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# We support and encourage derived works from this project, please read
# about our expectations at
#
#     https://www.nipreps.org/community/licensing/
#
###########################################################################
# Reports bootstrap file
# ======================
# This is a YAML-formatted file specifying how the NiReports assembler
# will search for "reportlets" and compose them into a report file,
# typically in HTML format.
###########################################################################

packagename: fmirprep
title: 'Fmriprep group report'
sections:
# - name: Summary
#   reportlets:
#   - bids: {datatype: figures, desc: summary, extension: [.html]}
- name: Basic confounds
  reportlets:
  - bids: {datatype: figures, desc: global, extension: [.html]}
    caption: the average signal within the brain mask
    subtitle: Global signal
  - bids: {datatype: figures, desc: csf, extension: [.html]}
    caption:  the average signal within anatomically-derived eroded CSF mask
    subtitle: Csf signal
  - bids: {datatype: figures, desc: white, extension: [.html]}
    caption: the average signal within anatomically-derived eroded white matter mask
    subtitle: White matter signal
  - bids: {datatype: figures, desc: rot, extension: [.html]}
    caption: the rotation parameters
    subtitle: Rotation parameters
  - bids: {datatype: figures, desc: trans, extension: [.html]}
    caption: the translation parameters
    subtitle: Translation parameters
- name: Outlier detection
  reportlets: 
  - bids: {datatype: figures, desc: framewise, extension: [.html]}
    caption: the framewise displacement
    subtitle: Framewise displacement
  - bids: {datatype: figures, desc: rmsd, extension: [.html]}
    caption: the root mean square displacement
    subtitle:   Root mean square displacement
  - bids: {datatype: figures, desc: dvars, extension: [.html]}
    caption: the DVARS
    subtitle: DVARS
  - bids: {datatype: figures, desc: std_dvars, extension: [.html]}
    caption: the standardized DVARS
    subtitle: Standardized DVARS
  - bids: {datatype: figures, desc: non_steady_state_outlier_XX, extension: [.html]}
    caption: the non-steady state outlier fraction
    subtitle: Non-steady state outlier fraction
  # - bids: {datatype: figures, desc: segmentation_l extension: [.html]}
  #   caption: displays the statistics values of volume and segmentation metrics
  #   subtitle: Interactive view of the brain surface metrics
  # - bids: {datatype: figures, desc: segmentation_volume_leftright, extension: [.html]}
  #   caption: displays the statistics values of volume and segmentation metrics
  #   subtitle: Interactive view of the brain surface metrics
  # - bids: {datatype: reportlets, desc: carpet}
  #   subtitle: Carpetplot and nuisance signals
  #   caption: The so-called &laquo;carpetplot&raquo; may assist in assessing head-motion
  #     derived artifacts and respiation effects.
# - name: Extended visual report
#   reportlets:
#   - bids: {datatype: figures, desc: mean}
#     subtitle: Average signal through time
#     caption: The average signal calculated across the last axis (time).
#   - bids: {datatype: figures, desc: airmask}
#     caption: The <em>hat</em>-mask calculated internally by MRIQC. Some metrics will use this
#       mask, for instance, to find out artifacts and estimate the spread of gaussian noise
#       added to the signal. This mask leaves out the air around the face to avoid measuring
#       noise sourcing from the eyeballs and their movement.
#     subtitle: '&laquo;Hat&raquo;-mask'
#   - bids: {datatype: figures, desc: noisefit}
#     caption: The noise fit internally estimated by MRIQC to calculate the QI<sub>1</sub> index
#       proposed by <a href="https://doi.org/10.1002/mrm.21992" target="_blank">Mortamet et al. (2009)</a>.
#     subtitle: Distribution of the noise within the <em>hat</em> mask
#     style:
#       max-width: 450px
#   - bids: {datatype: figures, desc: artifacts}
#     caption: Mask of artifactual intensities identified within the <em>hat</em>-mask.
#     subtitle: Artifactual intensities on the background
#   - bids: {datatype: figures, desc: brainmask}
#     caption: Brain mask as internally extracted by MRIQC. Defects on the brainmask could
#       indicate problematic aspects of the image quality-wise.
#     subtitle: Brain extraction performance
#   - bids: {datatype: figures, desc: head}
#     caption: A mask of the head calculated internally by MRIQC.
#     subtitle: Head mask
#   - bids: {datatype: figures, desc: segmentation}
#     caption: Brain tissue segmentation, as internally extracted by MRIQC.
#       Defects on this segmentation, as well as noisy tissue labels could
#       indicate problematic aspects of the image quality-wise.
#     subtitle: Brain tissue segmentation
#   - bids: {datatype: figures, desc: norm}
#     caption: This panel shows a <em>quick-and-dirty</em> nonlinear registration into
#       the <code>MNI152NLin2009cAsym</code> template accessed with
#       <a href="https://templateflow.org/browse" target="_blank"><em>TemplateFlow</em></a>.
#     subtitle: Spatial normalization of the anatomical image
    # static: false
- name: About
  nested: true
  reportlets:
  # - custom: errors
    # path: '{reportlets_dir}/{run_uuid}'
    # captions: <em>MRIQC</em> may have recorded failure conditions.
    # title: Errors
  - metadata: "input"
    settings:
      # By default, only the first dictionary will be expanded.
      # If folded is true, all will be folded. If false all expanded.
      folded: true
      # If an ID is not provided, one should be generated automatically
      id: 'fs-metadata'
    caption: |
      The quantitative metrics are also used in the Freesurfer group report.
    title: Metrics and provenance information

# Rating widget
plugins:
- module: nireports.assembler
  path: data/rating-widget/bootstrap.yml
